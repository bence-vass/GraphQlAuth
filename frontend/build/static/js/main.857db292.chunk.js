(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{48:function(e,t,a){e.exports=a.p+"static/media/va-logo.40bea301.svg"},50:function(e,t,a){e.exports=a.p+"static/media/text.3d55b2d0.svg"},51:function(e,t,a){e.exports=a.p+"static/media/react-grey.9531e039.svg"},52:function(e,t,a){e.exports=a.p+"static/media/jwt.b819a753.svg"},53:function(e,t,a){e.exports=a.p+"static/media/apollo.e7a87bb6.svg"},54:function(e,t,a){e.exports=a.p+"static/media/graphql.81b66a4f.svg"},55:function(e,t,a){e.exports=a.p+"static/media/docker.ce63d4a1.svg"},56:function(e,t,a){e.exports=a.p+"static/media/django.b88b5854.svg"},57:function(e,t,a){e.exports=a.p+"static/media/graphene.45eecdbc.svg"},58:function(e,t,a){e.exports=a.p+"static/media/certbot.befc8dc8.svg"},59:function(e,t,a){e.exports=a.p+"static/media/nginx.cd2acf55.svg"},60:function(e,t,a){e.exports=a.p+"static/media/figill.63f18e4b.svg"},65:function(e,t,a){e.exports=a.p+"static/media/jwtFig.fc6d1dc8.svg"},66:function(e,t,a){e.exports=a.p+"static/media/apolloDiagram.ee7fbac9.svg"},67:function(e,t,a){e.exports=a.p+"static/media/apolloCaching.d715e957.png"},68:function(e,t,a){e.exports=a.p+"static/media/queryexample.20223a72.png"},69:function(e,t,a){e.exports=a.p+"static/media/graphqlquery.e78bab8e.png"},71:function(e,t,a){e.exports=a(85)},77:function(e,t,a){},78:function(e,t,a){},85:function(e,t,a){"use strict";a.r(t);var n=a(46),r=a(24),l=a.n(r),o=a(31),i=a(16),c=a(0),s=a.n(c),u=a(47),m=a.n(u),h=(a(77),a(78),a(5)),d=a(10),p=a(17),f=a(18),E=a(48),b=a.n(E),g=function(){return s.a.createElement("ul",{className:"navbar"},s.a.createElement("li",null,s.a.createElement(h.b,{to:"/"},"Home")),s.a.createElement("li",null,s.a.createElement(h.b,{to:"/example"},"Example")),s.a.createElement("li",null,s.a.createElement(h.b,{to:"/codes"},"Codes")),s.a.createElement("li",null,s.a.createElement(h.b,{to:"/about"},"About")),s.a.createElement("a",{href:"https://bencevass.com/"},s.a.createElement("img",{src:b.a,alt:"Bence Vass"})))},v=a(6),y=a(7),w=a(9),k=a(8),x=a(50),j=a.n(x),I=a(51),O=a.n(I),S=a(52),q=a.n(S),N=a(53),A=a.n(N),T=a(54),C=a.n(T),D=a(55),G=a.n(D),$=a(56),Q=a.n($),P=a(57),R=a.n(P),W=a(58),J=a.n(W),L=a(59),U=a.n(L),F=a(60),M=a.n(F),V=function(e){return s.a.createElement("div",{className:"fig",style:e.style},s.a.createElement("img",{src:M.a,alt:"fig"}),e.children?s.a.createElement("div",{className:"text",style:e.textStyle},e.children):null)},z=function(e){Object(w.a)(a,e);var t=Object(k.a)(a);function a(){return Object(v.a)(this,a),t.apply(this,arguments)}return Object(y.a)(a,[{key:"render",value:function(){return s.a.createElement("div",{className:"home"},s.a.createElement("div",{className:"text"},s.a.createElement("img",{src:j.a,alt:"GraphQAuth"})),s.a.createElement("div",{className:"desc"},"Example project for JWT authentication in an SPA React.js app with Apollo through GraphQl API"),s.a.createElement(V,{style:{position:"absolute"}},"Hello, It is a showcase example of the JWT Auth.",s.a.createElement("br",null),"Check out the demo on the ",s.a.createElement(h.b,{to:"/example"},"example page"),s.a.createElement("br",null),"For more about the fundamentals, check out the ",s.a.createElement(h.b,{to:"/about"},"about page")),s.a.createElement("div",{className:"tech"},s.a.createElement("div",{style:{margin:"0 auto 4rem",width:"fit-content"}},s.a.createElement("div",{className:"techContainer"},s.a.createElement("img",{src:O.a,alt:"react"})),s.a.createElement("div",{className:"techContainer"},s.a.createElement("img",{src:q.a,alt:"jwt"})),s.a.createElement("div",{className:"techContainer"},s.a.createElement("img",{src:A.a,alt:"apollo"})),s.a.createElement("div",{className:"techContainer"},s.a.createElement("img",{src:C.a,alt:"graphql"}))),s.a.createElement("div",null,s.a.createElement("div",{className:"techContainer"},s.a.createElement("img",{src:G.a,alt:"docker"})),s.a.createElement("div",{className:"techContainer"},s.a.createElement("img",{src:U.a,alt:"nginx"})),s.a.createElement("div",{className:"techContainer"},s.a.createElement("img",{src:J.a,alt:"certbot"})),s.a.createElement("div",{className:"techContainer"},s.a.createElement("img",{src:Q.a,alt:"django"})),s.a.createElement("div",{className:"techContainer"},s.a.createElement("img",{src:R.a,alt:"graphene"})))),s.a.createElement(h.b,{to:"/about"},s.a.createElement("h2",null,"More about the tech")))}}]),a}(c.Component),B=function(e){Object(w.a)(a,e);var t=Object(k.a)(a);function a(){return Object(v.a)(this,a),t.apply(this,arguments)}return Object(y.a)(a,[{key:"render",value:function(){return s.a.createElement("div",null,localStorage.getItem("token")?s.a.createElement(d.a,{to:"/example/profile"}):s.a.createElement(d.a,{to:"/example/signup"}))}}]),a}(c.Component),Y=a(27),H=function(e){Object(w.a)(a,e);var t=Object(k.a)(a);function a(){return Object(v.a)(this,a),t.apply(this,arguments)}return Object(y.a)(a,[{key:"render",value:function(){return s.a.createElement("div",{className:"codes"},s.a.createElement(V,{style:{position:"fixed"},textStyle:{transform:"translate(100%, -5%)"}},s.a.createElement("div",{style:{textAlign:"left"}},"You can read here about:",s.a.createElement("ul",{style:{listStyleType:"none",margin:"10px",padding:0}},s.a.createElement("a",{href:"#prologue"},s.a.createElement("li",null,s.a.createElement("b",null,"The goal"))),s.a.createElement("li",null,s.a.createElement("b",null,"Frontend:"),s.a.createElement("ul",null,s.a.createElement("a",{href:"#auth"},s.a.createElement("li",null,"Authentication")),s.a.createElement("a",{href:"#store"},s.a.createElement("li",null,"Storing the tokens")),s.a.createElement("a",{href:"#refresh"},s.a.createElement("li",null,"Refreshing token")),s.a.createElement("a",{href:"#logout"},s.a.createElement("li",null,"Logout Method")),s.a.createElement("a",{href:"#expDisp"},s.a.createElement("li",null,"Expiration Display")),s.a.createElement("a",{href:"#refetch"},s.a.createElement("li",null,"Refetch Data")),s.a.createElement("a",{href:"#update"},s.a.createElement("li",null,"Update Data")))),s.a.createElement("li",null,s.a.createElement("b",null,"Backend:"),s.a.createElement("ul",null,s.a.createElement("li",null,"Graphene-Django"))),s.a.createElement("li",null,s.a.createElement("b",null,"DevOps:"),s.a.createElement("ul",null,s.a.createElement("a",{href:"#docker"},s.a.createElement("li",null,"Docker"))))))),s.a.createElement("a",{href:"https://github.com/bence-vass/GraphQlAuth",target:"_blank"},s.a.createElement("div",null,s.a.createElement("h3",null,"Source: Github repo"))),s.a.createElement("script",{src:"https://gist.github.com/bence-vass/3c363248e8dacfd7eaba9c5ddcc658b1.js"}),s.a.createElement("div",{className:"prologue",id:"prologue"},"I would like to write more about the difficulties of this project. The goal of this project was, that I could learn the usage of the GraphQl, the Apollo Client and the Graphene-Django package. Therefor please note, that this project is not a work of an expert, and there might be better solutions out there. But I am still sharing this with the hope, that others might learn about my mistakes and I can give some practical advise for other newcomers. If your not familiar with the following techs, I would recommend you to read the ",s.a.createElement("a",{href:"/about"},"About Page")," first, where I give a rough description about each fundamentals. In the following, I would like to highlight some of the not so clear part of my learning path, if you are interested in the full code example you can check that out in the Github repository."),s.a.createElement("div",{className:"frontend"},s.a.createElement("h2",{id:"auth"},"Authentication"),s.a.createElement("div",null,"In terms of basic queries and mutations, with the usage of the documentation it was pretty easy to learn, so the first authentication process was not a difficulty. The client send a request the server response, it is simple, but for permission required data you need to send your authentication token in the request, that cause me the first issue. Despite the fact that it is well documented \xa0",s.a.createElement("a",{href:"https://www.apollographql.com/docs/react/networking/authentication/#header"},"(link here)"),", at first I could not get the idea of the Apollo Links. So I definitely would recommend to read the",s.a.createElement("a",{href:"https://www.apollographql.com/docs/link/overview/"}," concept guide (link here)"),", first and only then start coding.",s.a.createElement("div",null,'For those, whom are interested in Graphene package, by default in the authorization the package use "JWT" + token for identification instead of "Bearer" in the header to identify the access token.')),s.a.createElement(Y.a,{id:"3c363248e8dacfd7eaba9c5ddcc658b1",file:"index1.js"}),s.a.createElement("h2",{id:"store"},"Storing the tokens"),s.a.createElement("div",null,"After the authentication, the client should store the data. As far as I am concerned one of the most popular why the do so, is storing them in the localStorage of the browser. After you leave the site it will remain stored, so even though the access token is expired, the refresh token can be used."),s.a.createElement("h2",{id:"refresh"},"Refreshing token"),s.a.createElement("div",null,"This is also a part of the project, which could not be understood unless you have read the ",s.a.createElement("a",{href:"https://www.apollographql.com/docs/link/overview/"},"Apollo Link guide"),".\xa0 The main concept, that if the access token is expired, with the refresh token the client request a new one. I think one of the best way out there, when the client made a request and the server respond that signature token is expired, the client should make a token refresh call then try again with the original request. There is no need to refresh tokens right after they are expired, it is easier to catch errors and handle them.",s.a.createElement("br",null),"After a lot of research I found a code in a \xa0",s.a.createElement("a",{href:"https://github.com/apollographql/apollo-link/issues/190#issuecomment-340736211"},"github thread by anju-kosambi"),", with a bit of modification I used it for the refresh process, which I found perfectly viable solution. With the \xa0",s.a.createElement("a",{href:"https://www.apollographql.com/docs/link/links/error/"},"apollo-link-error"),"\xa0 you can catch the error and modify the request accordingly. Although I made it with this method, I would like to mention the there a community link for this purpose \xa0",s.a.createElement("a",{href:"https://github.com/newsiberian/apollo-link-token-refresh"},"(link here) called apollo-link-token-refresh"),"\xa0 and at this point I can not emphasis enough the how useful could be reading through a documentation.",s.a.createElement("br",null),"This is the first time the I wrote authentication method, therefor it was not go without saying, for me how to handle different situation with token. For example what if the access token is invalid but the refresh is still live, what if the refresh is invalid. After bit of thinking I come to conclusion, that the app can not mess up with the stored data, if the token is invalid it is because of an auth server error or some kind of third party activity. In order to securely manage authentication data, I have found that the easiest way is to logout the user and clear the store."),s.a.createElement(Y.a,{id:"3c363248e8dacfd7eaba9c5ddcc658b1",file:"index2.js"}),s.a.createElement("h2",{id:"logout"},"Logout Method"),s.a.createElement("div",null,"The logout method clears the localStorage, clear the Apollo store, and set the values to the required value, then redirect to the home page."),s.a.createElement(Y.a,{id:"3c363248e8dacfd7eaba9c5ddcc658b1",file:"index3.js"}),s.a.createElement("h2",{id:"expDisp"},"Expiration Display"),s.a.createElement("div",null,"On each token refresh, Apollo updates the expiration time in its store. When the store is updated, Apollo automatically refetch the given queries and update the containing components. The components get the current time and expiration time and calculates the remaining interval in milliseconds, then set it as a state of the components."),s.a.createElement("h2",{id:"refetch"},"Refetch data"),s.a.createElement("div",null,"With the refetch button on profile page you can update apollo cache with the new server-data. You can see the request and response in your browser developer mode. If the access token has expired, you can see the three request, that have been made. The first is the user info query, which returns in this case an token expiration error. Secondly, the Apollo link catch the error and refresh the access token, and last but not least the original user query, but now with valid data."),s.a.createElement("h2",{id:"update"},"Update data"),s.a.createElement("div",null,"When you update your profile data, a mutation has been made, which tells the server, what kind of modification you intend to do. Normally you should than make a query to update the displayed information, but apollo provide an update function with each mutation, which makes it possible to modify data in the store without actual query, it updates the stored data and handle it as it is newly queried data and rerender the components accordingly.",s.a.createElement("br",null),"In this scenario the project has been set up this way, that the logged in user can query its data without any identification in the GraphQl request, it only identifies by the Authorization header, therefor there is no need of use ids in this case. I made the mistake that I requested id in the update mutation, there for it got an id in the store too. After the update, when I tried to refetch data it gives me error. I think it is a corner-case, but still worth to mention. This problem can be resolved with the identical fields in both the queries and mutations."),s.a.createElement(Y.a,{id:"3c363248e8dacfd7eaba9c5ddcc658b1",file:"ProfileUpdate.js"}),s.a.createElement("h2",{id:"docker"},"Docker"),s.a.createElement("div",null,"First of all, in developer mode the server would stop after it has successfully started, inorder to prevent that, and make it run, you have to set ",s.a.createElement("b",null,"tty: true"),". For hot reload you have to set the volumes, like it is in the docker code and also important, that you have to set ",s.a.createElement("b",null,"CHOKIDAR_USEPOLLING=true")," in the environment, unless it will not work."),s.a.createElement(Y.a,{id:"3c363248e8dacfd7eaba9c5ddcc658b1",file:"docker-compose.dev.yml"}),s.a.createElement("div",null,"For those ",s.a.createElement("b",null,"who use Mac for development"),", please note that it is not exactly suitable for this purpose. I tried to use it with the following configuration, but the ",s.a.createElement("b",null,"latency made it unusable"),". The request from the frontend toke from ",s.a.createElement("b",null,"15s to 40s to receive response"),"\xa0from the backend. It is being said, that it is some kind of sync error and it can be bypassed with the docker-sync library for mac, but I did not want to waste more time with this dead-end."),s.a.createElement("div",null,"There are multiple solutions for the React app hosting with Docker, but I found that, the best solution is to build the production code inside the container, but there is a serious drawback. On smaller sized ",s.a.createElement("b",null,"server with less than 2 GB RAM, it will eventually run out of memory"),", and it will fail to compile, in my experience. Since my goal was, to keep the project low-budget and make it long term sustainable, I wanted to keep it on the AWS nano instance, I had to find an other solution. It was obvious to pre-build the code and then upload it. This solution could not be more complicated, but it has its own advantage on the other side.")))}}]),a}(c.Component),K=function(e){Object(w.a)(a,e);var t=Object(k.a)(a);function a(){return Object(v.a)(this,a),t.apply(this,arguments)}return Object(y.a)(a,[{key:"render",value:function(){return s.a.createElement("div",{className:"about"},s.a.createElement("div",{className:"tech"},s.a.createElement(h.b,{to:"/about/apollo"},"Apollo Client"),s.a.createElement(h.b,{to:"/about/jwt"},"JWT"),s.a.createElement(h.b,{to:"/about/graphql"},"GraphQl"),s.a.createElement(h.b,{to:"/about/docker"},"Docker")))}}]),a}(c.Component),_=a(29);function X(){var e=Object(i.a)(["\n    mutation CreateUser(\n        $email: String!,\n        $username: String!,\n        $password: String!\n    ){\n        createUser(email: $email, username:$username,\n            password: $password){\n            user{\n                id\n                username\n            }\n        }\n\n    }\n"]);return X=function(){return e},e}function Z(){var e=Object(i.a)(["\n    mutation Login($username: String!, $password: String!){\n        tokenAuth(username: $username, password: $password){\n            payload\n            token\n            refreshToken\n            refreshExpiresIn\n        }\n    }\n"]);return Z=function(){return e},e}var ee=Object(p.a)(Z()),te=Object(p.a)(X()),ae=function(e){Object(w.a)(a,e);var t=Object(k.a)(a);function a(e){var n;return Object(v.a)(this,a),(n=t.call(this,e)).changeValue=function(e,t){n.setState(Object(_.a)({},t,e.target.value))},n.state={username:"",email:"",password:"",redirect:null},n}return Object(y.a)(a,[{key:"render",value:function(){var e=this;return s.a.createElement(f.a,{mutation:te,onCompleted:function(t){e.setState({email:"",password:"",username:""})},onError:function(e){console.log(e)}},(function(t,a){var n=a.data,r=(a.loading,a.error);return n?s.a.createElement(f.a,{mutation:ee,onCompleted:function(t){localStorage.setItem("token",t.tokenAuth.token),localStorage.setItem("refreshToken",t.tokenAuth.refreshToken),localStorage.setItem("exp",t.tokenAuth.payload.exp),localStorage.setItem("refreshExp",t.tokenAuth.refreshExpiresIn),e.setState({redirect:!0})},variables:{username:e.state.username,password:e.state.password}},(function(t,a){var n=a.data,r=a.client,l=a.called;return n&&r.writeData({data:{exp:n.tokenAuth.payload.exp,refreshExp:n.tokenAuth.refreshExpiresIn}}),e.state.redirect?s.a.createElement(d.a,{to:"/example/profile"}):(l||t(),s.a.createElement("div",null,"Logging in ..."))})):s.a.createElement("div",null,s.a.createElement("h1",null,"Sign up"),s.a.createElement("form",{onSubmit:function(a){a.preventDefault(),t({variables:{email:e.state.email,password:e.state.password,username:e.state.username}})}},r?r.message.split(":")[1].replace("[","").replace("]","").split(",").map((function(e,t){return" UNIQUE constraint failed"===e?s.a.createElement("div",{key:t,style:{textAlign:"center"}},"Username taken"):s.a.createElement("div",{key:t,style:{textAlign:"center"}},e.replace(/'/g,""))})):null,s.a.createElement("input",{type:"text",placeholder:"username",value:e.state.username,onChange:function(t){return e.changeValue(t,"username")},required:!0}),s.a.createElement("input",{type:"password",placeholder:"password",value:e.state.password,onChange:function(t){return e.changeValue(t,"password")},required:!0}),s.a.createElement("input",{type:"email",placeholder:"email",value:e.state.email,onChange:function(t){return e.changeValue(t,"email")},required:!0}),s.a.createElement("input",{type:"submit",value:"Sign Up"})),s.a.createElement(h.b,{to:"/example/login"},s.a.createElement("h2",null,"Login")))}))}}]),a}(s.a.Component),ne=function(e){Object(w.a)(a,e);var t=Object(k.a)(a);function a(){return Object(v.a)(this,a),t.apply(this,arguments)}return Object(y.a)(a,[{key:"render",value:function(){return s.a.createElement("div",{className:"signup"},s.a.createElement(V,null,"Please sign up or login on the left"),s.a.createElement(ae,null))}}]),a}(c.Component);function re(){var e=Object(i.a)(["\n    mutation Login($username: String!, $password: String!){\n        tokenAuth(username: $username, password: $password){\n            payload\n            token\n            refreshToken\n            refreshExpiresIn\n        }\n    }\n"]);return re=function(){return e},e}var le=Object(p.a)(re()),oe=function(e){Object(w.a)(a,e);var t=Object(k.a)(a);function a(e){var n;return Object(v.a)(this,a),(n=t.call(this,e)).changeValue=function(e,t){n.setState(Object(_.a)({},t,e.target.value))},n.state={username:"",password:"",redirect:null},n}return Object(y.a)(a,[{key:"render",value:function(){var e=this;return this.state.redirect?s.a.createElement(d.a,{to:"/example/profile"}):s.a.createElement(f.a,{mutation:le,onCompleted:function(t){localStorage.setItem("token",t.tokenAuth.token),localStorage.setItem("refreshToken",t.tokenAuth.refreshToken),localStorage.setItem("exp",t.tokenAuth.payload.exp),localStorage.setItem("refreshExp",t.tokenAuth.refreshExpiresIn),e.setState({redirect:!0})},onError:function(e){return console.log("Authentication error")}},(function(t,a){var n=a.data,r=(a.loading,a.error),l=a.client;return n&&l.writeData({data:{exp:n.tokenAuth.payload.exp,refreshExp:n.tokenAuth.refreshExpiresIn}}),s.a.createElement("div",null,s.a.createElement("h1",null,"Login"),s.a.createElement("form",{onSubmit:function(a){a.preventDefault(),t({variables:{username:e.state.username,password:e.state.password}})}},r?s.a.createElement("div",{style:{textAlign:"center"}},"Please enter valid credentials"):null,s.a.createElement("input",{type:"text",placeholder:"username",required:!0,onChange:function(t){return e.changeValue(t,"username")}}),s.a.createElement("input",{type:"password",placeholder:"password",required:!0,onChange:function(t){return e.changeValue(t,"password")}}),s.a.createElement("input",{type:"submit",value:"login"})))}))}}]),a}(s.a.Component),ie=function(e){Object(w.a)(a,e);var t=Object(k.a)(a);function a(){return Object(v.a)(this,a),t.apply(this,arguments)}return Object(y.a)(a,[{key:"render",value:function(){return s.a.createElement("div",{className:"login"},s.a.createElement(V,null,"Please sign up or login on the left"),s.a.createElement(oe,null),s.a.createElement(h.b,{to:"/example/signup"},s.a.createElement("h2",null,"Sign Up")))}}]),a}(c.Component);function ce(){var e=Object(i.a)(["\n    query{\n        me{\n            username\n            isStaff\n            firstName\n            lastName\n            email\n        }\n    }\n"]);return ce=function(){return e},e}var se=Object(p.a)(ce()),ue=function(e){Object(w.a)(a,e);var t=Object(k.a)(a);function a(){var e;return Object(v.a)(this,a),(e=t.call(this)).state={refetched:!1},e}return Object(y.a)(a,[{key:"render",value:function(){var e=this;return s.a.createElement(f.b,{query:se,onError:function(e){console.log("profile error")}},(function(t){var a=t.loading,n=(t.error,t.data),r=(t.updateQuery,t.refetch);return a?s.a.createElement("div",null,"Loading..."):s.a.createElement("div",{className:"profile"},s.a.createElement(V,null,e.state.refetched?s.a.createElement("div",null,"Your profile data has been updated, you can check out the request in the Network menu in developer mode. If your credentials are valid, it will be executed with them, otherwise it is going to request new ones."):s.a.createElement("div",null,"You can see your authentication tokens expiration down below")),s.a.createElement("h1",null,"Profile"),s.a.createElement("div",null,s.a.createElement("span",null,"Username:"),s.a.createElement("span",null,n&&n.me?n.me.username:"not yet")),s.a.createElement("div",null,s.a.createElement("span",null,"First name:"),s.a.createElement("span",null,n.me.firstName?n.me.firstName:"not given")),s.a.createElement("div",null,s.a.createElement("span",null,"Last name:"),s.a.createElement("span",null,n.me.lastName?n.me.lastName:"not given")),s.a.createElement("div",null,s.a.createElement("span",null,"Email:"),s.a.createElement("span",null,n.me.email?n.me.email:"not given")),s.a.createElement("button",{onClick:function(){r(),e.setState({refetched:!0}),setTimeout((function(){return e.setState({refetched:!1})}),2e4)}},"Refetch data"),s.a.createElement(h.b,{to:"/example/profile/update"},s.a.createElement("h5",{className:"update-btn"},"Update Profile")),s.a.createElement(h.b,{to:"/example/logout"},"Logout"))}))}}]),a}(c.Component),me=a(11),he=function(e){Object(w.a)(a,e);var t=Object(k.a)(a);function a(){return Object(v.a)(this,a),t.apply(this,arguments)}return Object(y.a)(a,[{key:"render",value:function(){return s.a.createElement(me.a,null,(function(e){return localStorage.clear(),e.writeData({data:{exp:0,refreshExp:0}}),e.clearStore(),s.a.createElement(d.a,{to:"/example/login"})}))}}]),a}(c.Component),de=a(34),pe=a.n(de),fe=a(41);function Ee(e,t){for(var a=e+"";a.length<t;)a="0"+a;return a}var be=function(e){var t=Object(c.useState)(0),a=Object(fe.a)(t,2),n=a[0],r=a[1],l=Object(c.useState)(0),o=Object(fe.a)(l,2),i=o[0],u=o[1];return i!==e.exp&&(u(e.exp),r(Math.floor((Number(1e3*e.exp)-Number(new Date))/1e3))),Object(c.useEffect)((function(){var e=n>0&&setInterval((function(){r(n-1)}),1e3);return function(){return clearInterval(e)}}),[n]),n<=0?s.a.createElement("span",null,"00 : 00"):s.a.createElement("span",null,Ee(Math.floor(n/60),2)," : ",Ee(n-60*Math.floor(n/60),2))};function ge(){var e=Object(i.a)(["{exp refreshExp}"]);return ge=function(){return e},e}var ve=function(e){Object(w.a)(a,e);var t=Object(k.a)(a);function a(){return Object(v.a)(this,a),t.apply(this,arguments)}return Object(y.a)(a,[{key:"render",value:function(){return s.a.createElement(f.b,{query:pe()(ge()),fetchPolicy:"cache-only"},(function(e){var t=e.data;return t?s.a.createElement("div",{className:"tokenDisplay"},s.a.createElement("table",null,s.a.createElement("thead",null,s.a.createElement("tr",null,s.a.createElement("th",{colSpan:2,className:"title"},s.a.createElement("span",null,"Expiration")))),s.a.createElement("tbody",null,s.a.createElement("tr",null,s.a.createElement("th",null,s.a.createElement("span",{className:"text"},"Access Token:")),s.a.createElement("th",null,s.a.createElement("b",null,s.a.createElement(be,{exp:t.exp})))),s.a.createElement("tr",null,s.a.createElement("th",null,s.a.createElement("span",{className:"text"},"Refresh Token:")),s.a.createElement("th",null,s.a.createElement("b",null,s.a.createElement(be,{exp:t.refreshExp}))))))):null}))}}]),a}(c.Component),ye=a(65),we=a.n(ye),ke=["#fb015b","#d63aff","#00b9f1"];var xe=function(){return s.a.createElement("div",null,s.a.createElement(V,null,"JWT is commonly used tech for safety measures"),s.a.createElement("div",{className:"about-container"},s.a.createElement("h2",null,"JSON Web Tokens"),s.a.createElement("div",null,s.a.createElement("i",null,'"JSON Web Tokens are an open, industry standard RFC 7519 method for representing claims securely between two parties."')),s.a.createElement("div",{className:"token"},s.a.createElement("b",null,localStorage.getItem("token")?s.a.createElement("div",null,s.a.createElement("div",null,"This is your access token:"),localStorage.getItem("token").split(".").map((function(e,t){return s.a.createElement("span",{key:t},s.a.createElement("span",{style:{color:ke[t]}},e),2!==t?".":null)}))):s.a.createElement("div",null,s.a.createElement("div",null,"This is an example token:"),"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c".split(".").map((function(e,t){return s.a.createElement("span",{key:t},s.a.createElement("span",{style:{color:ke[t]}},e),2!==t?".":null)}))))),s.a.createElement("div",null,"It has three parts: the header, which contains the algorithm and token type, the payload which is the data it self, and the verifying signature.\xa0",s.a.createElement("a",{href:"https://jwt.io/"},"You can check out the the decoded data on the official site of JWT")),s.a.createElement("button",{onClick:function(){localStorage.getItem("token")&&function(e){var t=document.createElement("textarea");document.body.appendChild(t),t.value=e,t.select(),document.execCommand("copy"),document.body.removeChild(t)}(localStorage.getItem("token")),window.open("https://jwt.io/")}},"Copy Token and Redirect to jwt.io"),s.a.createElement("img",{src:we.a,alt:"jwt",className:"ill-img"}),s.a.createElement("div",null,"In this experimental case you have significantly shorter token expiration time, for the purpose of demonstration, but in real life scenario the access token lives about 15 min and the refresh token around a week."),s.a.createElement("div",null,"For more advanced security you can generate new refresh token with access token. In this project, after the request, the server revoke the previous token and only with the newly generated credentials can be the process repeated.")))},je=a(66),Ie=a.n(je),Oe=a(67),Se=a.n(Oe),qe=function(){return s.a.createElement("div",null,s.a.createElement(V,null,"If you are not familiar with Apollo Client please read this short description or read the documentation, for better understanding."),s.a.createElement("div",{className:"about-container"},s.a.createElement("h2",null,"Apollo Client"),s.a.createElement("i",null,'"Apollo Client is a complete state management library for JavaScript apps. Simply write a GraphQL query, and Apollo Client will take care of requesting and caching your data, as well as updating your UI."'),s.a.createElement("img",{src:Ie.a,alt:"apollo graphq"}),s.a.createElement("div",null,"With Apollo you can query and mutate data, with the greatest ease, since you can use the exact code that you use with GraphQl UI. In concept it is very different from Redux, but in it can be used pretty similarly. It helps you to manage data through components, which makes Redux in this case unnecessary, in my opinion. It could eliminate the necessity of the usage of Redux, because, Apollo`s store can rerender components, when the queried data has been changed in the store."),s.a.createElement("img",{src:Se.a,alt:"apollo graphq"}),s.a.createElement("a",{href:"https://www.apollographql.com/docs/"},s.a.createElement("div",null,"For more detailed description, please check out the official documentation (link here)"))))},Ne=function(){return s.a.createElement("div",null,s.a.createElement(V,null,"Here you can learn more about the stacks"),s.a.createElement("div",{className:"about-container"},s.a.createElement("div",null,"It is a guide for newbies for some of the cutting edge techs, if you want to know more about its solutions, you should read the ",s.a.createElement(h.b,{to:"codes"},"Codes section"),".",s.a.createElement("a",{href:"https://github.com/bence-vass/GraphQlAuth",target:"_blank"},s.a.createElement("div",null,s.a.createElement("h3",null,"Source: Github repo")))),s.a.createElement("h2",null,"The goal"),s.a.createElement("div",null,"This project is a learning-project, I knew nothing about GraphQl nor Graphene at the beginning, but I could master some of the techniques, through this project. Hopefully it will be a great base for later, will come handy with more robust projects with similar stack. My solutions might not be the best, but I hope that others could learn about my mistakes and avoid them.")))};function Ae(){var e=Object(i.a)(["\n    query{\n        me{\n            username\n            isStaff\n            firstName\n            lastName\n            email\n        }\n    }\n"]);return Ae=function(){return e},e}function Te(){var e=Object(i.a)(["\n    mutation UpdateProfile(\n        $firstname: String,\n        $lastname: String,\n        $email: String,\n    ){\n        updateProfile(firstName: $firstname, lastName: $lastname, email: $email){\n            user{\n                username\n                firstName\n                lastName\n                email\n            }\n        }\n    }\n"]);return Te=function(){return e},e}var Ce=Object(p.a)(Te()),De=Object(p.a)(Ae()),Ge=function(e){Object(w.a)(a,e);var t=Object(k.a)(a);function a(e){var n;return Object(v.a)(this,a),(n=t.call(this,e)).changeValue=function(e,t){n.setState(Object(_.a)({},t,e.target.value))},n.state={firstname:"",lastname:"",email:"",redirect:!1},n}return Object(y.a)(a,[{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"update"},s.a.createElement(V,null,"The mutation can update the data locally in the cache if it was successful, without refetching the data from the network."),s.a.createElement(f.b,{query:De,onCompleted:function(){var t=Object(o.a)(l.a.mark((function t(a){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.setState({firstname:a.me.firstName,lastname:a.me.lastName,email:a.me.email});case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},(function(e){e.data,e.called;return null})),s.a.createElement(f.a,{mutation:Ce,update:function(e,t){var a=t.data.updateProfile.user;e.writeQuery({query:De,data:{me:a}})},onError:function(e){return null}},(function(t,a){var n=a.data,r=a.error;return e.state.redirect?s.a.createElement(d.a,{to:"/example/profile"}):(n&&e.setState({redirect:!0}),s.a.createElement("div",null,s.a.createElement("form",{onSubmit:function(a){a.preventDefault(),t({variables:{firstname:e.state.firstname,lastname:e.state.lastname,email:e.state.email}})}},r?s.a.createElement("div",null,r.message):null,s.a.createElement("div",null,s.a.createElement("span",null,"First name:"),s.a.createElement("input",{type:"text",placeholder:"First name",value:e.state.firstname,onChange:function(t){return e.changeValue(t,"firstname")}})),s.a.createElement("div",null,s.a.createElement("span",null,"Last name:"),s.a.createElement("input",{type:"text",placeholder:"Last name",value:e.state.lastname,onChange:function(t){return e.changeValue(t,"lastname")}})),s.a.createElement("div",null,s.a.createElement("span",null,"Email:"),s.a.createElement("input",{type:"email",placeholder:"Email address",value:e.state.email,onChange:function(t){return e.changeValue(t,"email")}})),s.a.createElement("input",{type:"submit",value:"Update"}))))})))}}]),a}(c.Component),$e=function(){return s.a.createElement("div",null,s.a.createElement(V,null,"Docker is a largely scalable and it is ideal to quick start your project on all environment. I recommend you to use it even in earlier development state too"),s.a.createElement("div",{className:"about-container"},s.a.createElement("h2",null,"Docker"),s.a.createElement("i",null,s.a.createElement("div",null,'"Docker is a platform for developers and sysadmins to build, run, and share applications with containers. The use of containers to deploy applications is called containerization. Containers are not new, but their use for easily deploying applications is."')),s.a.createElement("div",null,"Docker can be useful for every kind of project in order to easily setup at all environment. My first intention was, to dockerize the back- and frontend even in the development state. I would recommend you to be cautious with your system specs, because if you want to keep your project on low-budget, you have to compromise, accept with other solutions.")))},Qe=a(68),Pe=a.n(Qe),Re=a(69),We=a.n(Re),Je=function(){return s.a.createElement("div",null,s.a.createElement(V,null,"It can highly increase user experience, especially areas with slower data connection"),s.a.createElement("div",{className:"about-container"},s.a.createElement("h2",null,"GraphQl"),s.a.createElement("i",null,s.a.createElement("div",null,'"GraphQL is a query language for APIs and a runtime for fulfilling those queries with your existing data. GraphQL provides a complete and understandable description of the data in your API, gives clients the power to ask for exactly what they need and nothing more, makes it easier to evolve APIs over time, and enables powerful developer tools."')),s.a.createElement("img",{src:Pe.a,alt:"qraphql"}),s.a.createElement("div",null,"I had experiences with RestAPI, but after using GraphQl, I could not see RestAPI as the best solution for backend-frontend communication any more. Despite the fact that, I did not make any measurements between these two in terms of computation demand and speed, but it is clear that the GraphQl is more capable with the now days standards. With the solution that you only query data, that you need, it is capable to sending significantly smaller requests and responses. After all, since everything about the UX, and some countries have exceedingly slow mobile data connection, it could be the best solution to increase user experience."),s.a.createElement("img",{src:We.a,alt:"graphql"}),s.a.createElement("a",{href:"https://graphql.org/learn/"},s.a.createElement("div",null,"You can check out the GraphQl site for more advanced description (link here)"))))},Le=function(e){Object(w.a)(a,e);var t=Object(k.a)(a);function a(){return Object(v.a)(this,a),t.apply(this,arguments)}return Object(y.a)(a,[{key:"render",value:function(){return s.a.createElement("div",{className:"network-err"},s.a.createElement("h1",null,"Oops... something went wrong."),s.a.createElement("h3",null,"Please try again later"))}}]),a}(c.Component);function Ue(){var e=Object(i.a)(["\n    mutation Verify(\n        $token: String!,\n    ){\n        verifyToken(token:$token){\n            payload\n        }\n    }\n"]);return Ue=function(){return e},e}var Fe=Object(p.a)(Ue());c.Component;function Me(){var e=Object(i.a)(["query{networkStatus}"]);return Me=function(){return e},e}var Ve=function(){return s.a.createElement("div",{className:"App"},s.a.createElement(h.a,null,s.a.createElement(g,null),s.a.createElement(d.b,{path:"/about"},s.a.createElement(K,null)),s.a.createElement(d.b,{path:"/example"},s.a.createElement(ve,null)),s.a.createElement(f.b,{query:Object(p.a)(Me()),fetchPolicy:"cache-only"},(function(e){var t=e.data,a=e.client;return t&&0===t.networkStatus?(a.writeData({data:{networkStatus:1}}),s.a.createElement(d.a,{to:"/network-error"})):null})),s.a.createElement(d.d,null,s.a.createElement(d.b,{path:"/example/signup"},s.a.createElement(ne,null)),s.a.createElement(d.b,{path:"/example/login"},s.a.createElement(ie,null)),s.a.createElement(d.b,{path:"/example/logout"},s.a.createElement(he,null)),s.a.createElement(d.b,{path:"/example/profile/update"},s.a.createElement(Ge,null)),s.a.createElement(d.b,{path:"/example/profile"},s.a.createElement(ue,null)),s.a.createElement(d.b,{path:"/example"},s.a.createElement(B,null)),s.a.createElement(d.b,{path:"/codes"},s.a.createElement(H,null)),s.a.createElement(d.b,{path:"/about/apollo"},s.a.createElement(qe,null)),s.a.createElement(d.b,{path:"/about/jwt"},s.a.createElement(xe,null)),s.a.createElement(d.b,{path:"/about/graphql"},s.a.createElement(Je,null)),s.a.createElement(d.b,{path:"/about/docker"},s.a.createElement($e,null)),s.a.createElement(d.b,{exact:!0,path:"/about"},s.a.createElement(Ne,null)),s.a.createElement(d.b,{exact:!0,path:"/network-error"},s.a.createElement(Le,null)),s.a.createElement(d.b,{exact:!0,path:"/"},s.a.createElement(z,null)))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var ze=a(22),Be=a(28),Ye=a(12),He=a(15),Ke=a(25),_e=a(33);function Xe(){var e=Object(i.a)(["\n    mutation RefreshToken($token: String!) {\n        refreshToken(refreshToken: $token) {\n            token\n            payload\n            refreshToken\n            refreshExpiresIn\n        }\n    }\n"]);return Xe=function(){return e},e}var Ze=Object(p.a)(Xe()),et=function(){var e=Object(o.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",it.mutate({mutation:Ze,variables:{token:t}}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),tt=["Signature has expired"],at={uri:"https://".concat(window.location.hostname,"/graphql/")};var nt=new Be.a(at),rt=new Ye.a((function(e,t){return localStorage.getItem("token")&&e.setContext({headers:{authorization:"JWT "+localStorage.getItem("token")}}),t(e)})),lt=Object(_e.a)((function(e){var t=e.graphQLErrors,a=e.networkError,r=e.operation,l=e.forward;if(t){var o,i=Object(n.a)(t);try{for(i.s();!(o=i.n()).done;){var c=o.value;if(tt.includes(c.message)){if(localStorage.getItem("refreshToken"))return new He.a((function(e){et(localStorage.getItem("refreshToken")).then((function(e){console.log(e),localStorage.setItem("token",e.data.refreshToken.token),localStorage.setItem("refreshToken",e.data.refreshToken.refreshToken),localStorage.setItem("exp",e.data.refreshToken.payload.exp),localStorage.setItem("refreshExp",e.data.refreshToken.refreshExpiresIn),r.setContext({headers:{authorization:"JWT "+e.data.refreshToken.token}}),it.writeData({data:{exp:e.data.refreshToken.payload.exp,refreshExp:e.data.refreshToken.refreshExpiresIn}})})).catch((function(e){console.log(e),console.log("err in refresh"),window.location.replace("/example/logout")})).then((function(){var t={next:e.next.bind(e),error:e.error.bind(e),complete:e.complete.bind(e)};l(r).subscribe(t)})).catch((function(t){console.log("error at end of reauth"),e.error(t)}))}))}else console.log("unhadnled grpahq"),console.log(c)}}catch(c){i.e(c)}finally{i.f()}}a&&"Failed to fetch"===a.message&&it.writeData({data:{networkStatus:0}})})),ot=new Ke.a,it=new ze.a({cache:ot,link:Object(Ye.c)([lt,rt,nt])}),ct={exp:0,refreshExp:0};localStorage.getItem("exp")&&localStorage.getItem("refreshExp")&&(ct={exp:localStorage.getItem("exp"),refreshExp:localStorage.getItem("refreshExp")}),ot.writeData({data:ct}),it.onClearStore(Object(o.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ot.writeData({data:ct});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))),it.onResetStore(Object(o.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ot.writeData({data:ct});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))),m.a.render(s.a.createElement(s.a.StrictMode,null,s.a.createElement(me.b,{client:it},s.a.createElement(Ve,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[71,1,2]]]);
//# sourceMappingURL=main.857db292.chunk.js.map